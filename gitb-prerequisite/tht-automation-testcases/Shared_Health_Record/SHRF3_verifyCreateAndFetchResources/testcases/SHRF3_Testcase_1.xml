<?xml version="1.0" encoding="UTF-8"?>
<testcase id="SHRF3_Testcase_1" xmlns="http://www.gitb.com/tdl/v1/" xmlns:gitb="http://www.gitb.com/core/v1/">
    <metadata>
		<gitb:name>SHRF3_Testcase_1</gitb:name>
		<gitb:type>CONFORMANCE</gitb:type>
		<gitb:version>1.0</gitb:version>
		<gitb:description>Test case to verify FHIR resource patient related operations</gitb:description>
	</metadata>
    <imports>
        <!-- read data from the JSON stores in name as json string-->
        <artifact type="binary" encoding="UTF-8" name="patientToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/PatientToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="practitionerToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/PractitionerToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="organizationToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/OrganizationToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="practitionerRoleToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/PractitionerRoleToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="encounterToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/EncounterToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="conditionToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/ConditionToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="medicationToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/MedicationToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="medicationRequestToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/MedicationRequestToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="immunizationToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/ImmunizationToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="diagnosticReportToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/DiagnosticReportToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="medicationAdministrationToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/MedicationAdministrationToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="allergyIntoleranceToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/AllergyIntoleranceToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="procedureToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/ProcedureToCreate.json</artifact>
        <artifact type="binary" encoding="UTF-8" name="observationToCreateInJsonString">/SHRF3_verifyCreateAndFetchResources/resources/ObservationToCreate.json</artifact>
    </imports>
    <variables>
        <var name="componentURI" type="string"/>
        <var name="username" type="string"/>
        <var name="password" type="string"/>
        <var name="loginUrl" type="string"/>
        <var name="loginType" type="string"/>
        <var name="clientSecret" type="string"/>
        <var name="clientId" type="string"/>
        <var name="headerParamName" type="string"/>
        <var name="headerParamValue" type="string"/>
    </variables>
    <actors>
		<gitb:actor id="ITB" name="ITB" role="SUT"/>
		<gitb:actor id="FhirHandler" name="FhirHandlers" role="SIMULATED"/>
	</actors>
    <steps stopOnError="true">

        <!--
            assign will stores value in variable, and it can be used as $variable_name

            right now ITB doesn't support parsing JsonString as map/array
            but it has specific type anyContent which works as map
            and we can do stuff like $variable_name{$property_name_1}{0}{$property_name_2}

            Detailed document : https://www.itb.ec.europa.eu/docs/tdl/latest/expressions/index.html#referring-to-variables
        -->
        <assign to="resourceType" type="string">'Patient'</assign>


        <!-- 
            send operation execute send method of handler (Which is written in JavaCode)
            send operation's response will get stored in id 


            Right now we have following custom handlers with following inputs:
            1. $DOMAIN{jsonStringConverterServiceAddress} - converts anyContent <-> jsonString
                1.body
                    - required 
                    - body which needs to be converted anyContent <-> jsonString                
                2.bodyType
                    - optional
                    - default value = anyContent
                    - possible value = jsonString, anyContent
                    - convert body to opposite type.
            Response 
                - Structure $send_id{convertedBody}

            2. $DOMAIN{fhirContextServiceAddress} - make operations for the FHIR
                1.fhirServerBaseUrl
                    - required
                    - base URL of FHIR Server
                2.fhirVersion
                    - optional
                    - default value = R4
                    - possible value = DSTU2, DSTU3, STU3, R4, R4B, R5, Partial version strings (e.g. "3.0")
                3.connectTimeout
                    - optional
                    - deafault value = 60000 (in milliseconds)
                    - Sets the connect timeout, in milliseconds. This is the amount of time that the initial connection attempt network operation may block without failing.
                4.socketTimeout
                    - optional
                    - deafault value = 60000 (in milliseconds)
                    - Sets the socket timeout, in milliseconds. This is the SO_TIMEOUT time, which is the amount of time that a read/write network operation may block without failing.
                5.userName
                    - optional
                    - username for the basic username/password based authentication/authorization
                6.password
                    - optional
                    - password for the basic username/password based authentication/authorization
                7.token
                    - optional
                    - token for the bearer token based authentication/authorization
                8.responseType
                    - optional
                    - default value = anyContent
                    - possible value = jsonString, anyContent
                9.operationType
                    - required
                    - possible value = create, update, delete, search, getById, getHistoryById
                    
                extra parameters depending on operation:
                create/update:
                    1.bodyType
                        - optional
                        - default value = anyContent
                        - possible value = jsonString, anyContent
                    2.body
                        -required
                        -resource data which needs to be created/update
                search:
                    1.fhirResourceType
                        - required
                        - possible value = Patient, etc.
                        - ResourceType of FHIR resource which needs to be fetched
                    2.parameters
                        -required
                        -parameters as query parameters for filter
                getById/delete/getHistoryById:
                    1.fhirResourceType
                        - required
                        - possible value = Patient, etc.
                        - ResourceType of FHIR resource for which we're making operation
                    2.fhirResourceId
                        - required
                        - ID of FHIR resource for which we're making operation
            Response Structure 
                - $send_id{request}{endpoint}
                - $send_id{request}{body}
                - $send_id{response}{status}
                - $send_id{response}{body}

            3. $DOMAIN{apiCallServiceAddress} - make any kind of calls
                1.httpMethod
                    - required
                    - possible value = GET, HEAD, POST, PUT, PATCH, DELETE, OPTIONS, TRACE
                    - Http Method Types
                2.url
                    - required
                    - url for the Http Request
                3.mediaType
                    -optional
                    -deafult value = application/json, etc
                    -mediaType for the Http Call
                3.body
                    -optional
                    -request body for the Http Call
                4.header
                    -optional
                    -header parameters for the Http Call
                5.responseType
                    - optional
                    - default value = anyContent
                    - possible value = jsonString, anyContent
            Response Structure 
                - $send_id{request}{endpoint}
                - $send_id{request}{body}
                - $send_id{response}{status}
                - $send_id{response}{body}
        -->

        <!-- Convert Patient -->

        <send id="patientToCreate" desc="Convert patientToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$patientToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <!--
            Add log
        -->
        <log>'Converted Patient Data'</log>
        <log>$patientToCreate</log>

        <!-- Create Patient -->

        <send id="createdPatient" desc="Create Patient in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$patientToCreate{convertedBody}</input>
        </send>

        <log>'Created Patient Data'</log>
        <log>$createdPatient</log>

        <!--
            verify data
        -->
        <verify id="verifyCreatePatient" handler="StringValidator" desc="Check that patient got created successfully or not with correct data.">
            <input name="actualstring">$createdPatient{response}{body}{birthDate}</input>
            <input name="expectedstring">'1970-01-01'</input>
        </verify>

        <!-- Search Patient -->

        <send id="searchedPatient" desc="search same patient from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">$resourceType</input>
            <input name="parameters">"_id=" || $createdPatient{response}{body}{id}</input>
        </send>
     
        <log>'Searched Patient Data'</log>
        <log>$searchedPatient</log>

        <!-- Verify searched patient -->

        <verify id="verifySearchPatient" handler="StringValidator" desc="Verify data of patient">
            <input name="actualstring">$searchedPatient{response}{body}{entry}{0}{resource}{id}</input>
            <input name="expectedstring">$createdPatient{response}{body}{id}</input>
        </verify>

         <!-- Convert Practitioner -->

        <send id="practitionerToCreate" desc="Convert practitionerToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$practitionerToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <!--
            Add log
        -->
        <log>'Converted Practitioner Data'</log>
        <log>$practitionerToCreate</log>

        <!-- Create Practitioner -->

        <send id="createdPractitioner" desc="Create Practitioner in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$practitionerToCreate{convertedBody}</input>
        </send>

        <log>'Created Practitioner Data'</log>
        <log>$createdPractitioner</log>

        <!--
            verify data
        -->
        <verify id="verifyCreatePractitioner" handler="StringValidator" desc="Check that practitioner got created successfully or not with correct data.">
            <input name="actualstring">$createdPractitioner{response}{body}{birthDate}</input>
            <input name="expectedstring">'1970-02-02'</input>
        </verify>

        <!-- Search Practitioner -->

        <send id="searchedPractitioner" desc="search same practitioner from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'Practitioner'</input>
            <input name="parameters">"_id=" || $createdPractitioner{response}{body}{id}</input>
        </send>
     
        <log>'Searched Practitioner Data'</log>
        <log>$searchedPractitioner</log>

        <!-- Verify Searched Practitioner -->

        <verify id="verifySearchPractitioner" handler="StringValidator" desc="Verify data of practitioner">
            <input name="actualstring">$searchedPractitioner{response}{body}{entry}{0}{resource}{id}</input>
            <input name="expectedstring">$createdPractitioner{response}{body}{id}</input>
        </verify>

        <!-- Convert Organization -->

        <send id="organizationToCreate" desc="Convert organizationToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$organizationToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <!--
            Add log
        -->
        <log>'Converted Organization Data'</log>
        <log>$organizationToCreate</log>

        <!-- Create Organization -->

        <send id="createdOrganization" desc="Create Organization in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$organizationToCreate{convertedBody}</input>
        </send>

        <log>'Created Organization Data'</log>
        <log>$createdOrganization</log>

        <!--
            verify data
        -->
        <verify id="verifyCreateOrganization" handler="StringValidator" desc="Check that organization got created successfully or not with correct data.">
            <input name="actualstring">$createdOrganization{response}{body}{name}</input>
            <input name="expectedstring">'Health System Inc.'</input>
        </verify>

        <!-- Search Organization -->

        <send id="searchedOrganization" desc="search same organization from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'Organization'</input>
            <input name="parameters">"_id=" || $createdOrganization{response}{body}{id}</input>
        </send>
     
        <log>'Searched Organization Data'</log>
        <log>$searchedOrganization</log>

        <!-- Verify Searched Organization -->

        <verify id="verifySearchOrganization" handler="StringValidator" desc="Verify data of organization">
            <input name="actualstring">$searchedOrganization{response}{body}{entry}{0}{resource}{name}</input>
            <input name="expectedstring">$createdOrganization{response}{body}{name}</input>
        </verify>

        <!-- Convert Practitioner Role -->

        <send id="practitionerRoleToCreate" desc="Convert practitionerRoleToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$practitionerRoleToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <assign to="practitionerRoleToCreate{convertedBody}{practitioner}{reference}">'Practitioner/'||$createdPractitioner{response}{body}{id}</assign>
        <assign to="practitionerRoleToCreate{convertedBody}{organization}{reference}">'Organization/'||$createdOrganization{response}{body}{id}</assign>

        <!--
            Add log
        -->
        <log>'Converted PractitionerRole Data'</log>
        <log>$practitionerRoleToCreate</log>

        <!-- Create PractitionerRole -->

        <send id="createdPractitionerRole" desc="Create PractitionerRole in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$practitionerRoleToCreate{convertedBody}</input>
        </send>

        <log>'Created PractitionerRole Data'</log>
        <log>$createdPractitionerRole</log>

        <!--
            verify data
        -->
        <verify id="verifyCreatePractitionerRole" handler="StringValidator" desc="Check that practitionerRole got created successfully or not with correct data.">
            <input name="actualstring">$createdPractitionerRole{response}{body}{code}{0}{coding}{0}{code}</input>
            <input name="expectedstring">'GP'</input>
        </verify>

        <!-- Search PractitionerRole -->

        <send id="searchedPractitionerRole" desc="search same practitionerRole from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'PractitionerRole'</input>
            <input name="parameters">"_id=" || $createdPractitionerRole{response}{body}{id}</input>
        </send>
     
        <log>'Searched PractitionerRole Data'</log>
        <log>$searchedPractitionerRole</log>

        <!-- Verify Searched PractitionerRole -->

        <verify id="verifySeachPractitionerRole" handler="StringValidator" desc="Verify data of practitionerRole">
            <input name="actualstring">$searchedPractitionerRole{response}{body}{entry}{0}{resource}{code}{0}{coding}{0}{code}</input>
            <input name="expectedstring">$createdPractitionerRole{response}{body}{code}{0}{coding}{0}{code}</input>
        </verify>

         <!-- Convert Encounter -->

        <send id="encounterToCreate" desc="Convert encounterToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$encounterToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <assign to="encounterToCreate{convertedBody}{subject}{reference}">'Patient/'||$createdPatient{response}{body}{id}</assign>
        <assign to="encounterToCreate{convertedBody}{participant}{0}{individual}{reference}">'Practitioner/'||$createdPractitioner{response}{body}{id}</assign>

        <!--
            Add log
        -->
        <log>'Converted rncounter Data'</log>
        <log>$encounterToCreate</log>

        <!-- Create Encounter -->

        <send id="createdEncounter" desc="Create Encounter in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$encounterToCreate{convertedBody}</input>
        </send>

        <log>'Created Encounter Data'</log>
        <log>$createdEncounter</log>

        <!--
            verify data
        -->
        <verify id="verifyCreateEncounter" handler="StringValidator" desc="Check that encounter got created successfully or not with correct data.">
            <input name="actualstring">$createdEncounter{response}{body}{period}{start}</input>
            <input name="expectedstring">'2019-04-04T00:00:00+05:30'</input>
        </verify>

        <!-- Search Encounter -->

        <send id="searchedEncounter" desc="search same encounter from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'Encounter'</input>
            <input name="parameters">"_id=" || $createdEncounter{response}{body}{id}</input>
        </send>
     
        <log>'Searched Encounter Data'</log>
        <log>$searchedEncounter</log>

        <!-- Verify Searched Encounter -->

        <verify id="verifySearchEncounter" handler="StringValidator" desc="Verify data of encounter">
            <input name="actualstring">$searchedEncounter{response}{body}{entry}{0}{resource}{period}{start}</input>
            <input name="expectedstring">$createdEncounter{response}{body}{period}{start}</input>
        </verify>




        <!-- Convert Condition -->

        <send id="conditionToCreate" desc="Convert conditionToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$conditionToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <assign to="conditionToCreate{convertedBody}{subject}{reference}">'Patient/'||$createdPatient{response}{body}{id}</assign>
        <assign to="conditionToCreate{convertedBody}{encounter}{reference}">'Encounter/'||$createdEncounter{response}{body}{id}</assign>

        <!--
            Add log
        -->
        <log>'Converted Condition Data'</log>
        <log>$conditionToCreate</log>

        <!-- Create Condition -->

        <send id="createdCondition" desc="Create Condition in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$conditionToCreate{convertedBody}</input>
        </send>

        <log>'Created Condition Data'</log>
        <log>$createdCondition</log>

        <!--
            verify data
        -->
        <verify id="verifyCreateCondition" handler="StringValidator" desc="Check that condition got created successfully or not with correct data.">
            <input name="actualstring">$createdCondition{response}{body}{code}{coding}{0}{code}</input>
            <input name="expectedstring">'12345'</input>
        </verify>

        <!-- Search Condition -->

        <send id="searchedCondition" desc="search same condition from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'Condition'</input>
            <input name="parameters">"_id=" || $createdCondition{response}{body}{id}</input>
        </send>
     
        <log>'Searched Condition Data'</log>
        <log>$searchedCondition</log>

        <!-- Verify Searched Condition -->

        <verify id="verifySearchCondition" handler="StringValidator" desc="Verify data of encounter">
            <input name="actualstring">$searchedCondition{response}{body}{entry}{0}{resource}{code}{coding}{0}{code}</input>
            <input name="expectedstring">$createdCondition{response}{body}{code}{coding}{0}{code}</input>
        </verify>




        <!-- Convert Medication -->

        <send id="medicationToCreate" desc="Convert medicationToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$medicationToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <!--
            Add log
        -->
        <log>'Converted Medication Data'</log>
        <log>$medicationToCreate</log>

        <!-- Create Medication -->

        <send id="createdMedication" desc="Create Medication in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$medicationToCreate{convertedBody}</input>
        </send>

        <log>'Created Medication Data'</log>
        <log>$createdMedication</log>

        <!--
            verify data
        -->
        <verify id="verifyCreateMedication" handler="StringValidator" desc="Check that medication got created successfully or not with correct data.">
            <input name="actualstring">$createdMedication{response}{body}{code}{coding}{0}{code}</input>
            <input name="expectedstring">'12345'</input>
        </verify>

        <!-- Search Medication -->

        <send id="searchedMedication" desc="search same medication from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'Medication'</input>
            <input name="parameters">"_id=" || $createdMedication{response}{body}{id}</input>
        </send>
     
        <log>'Searched Medication Data'</log>
        <log>$searchedMedication</log>

        <!-- Verify Searched Medication -->

        <verify id="verifySearchMedication" handler="StringValidator" desc="Verify data of encounter">
            <input name="actualstring">$searchedMedication{response}{body}{entry}{0}{resource}{code}{coding}{0}{code}</input>
            <input name="expectedstring">$createdMedication{response}{body}{code}{coding}{0}{code}</input>
        </verify>


        <!-- Convert Medication Request -->

        <send id="medicationRequestToCreate" desc="Convert medicationRequestToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$medicationRequestToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <assign to="medicationRequestToCreate{convertedBody}{medicationReference}{id}">'Medication/'||$createdMedication{response}{body}{id}</assign>
        <assign to="medicationRequestToCreate{convertedBody}{subject}{reference}">'Patient/'||$createdPatient{response}{body}{id}</assign>

        <!--
            Add log
        -->
        <log>'Converted MedicationRequest Data'</log>
        <log>$medicationRequestToCreate</log>

        <!-- Create Medication Request -->

        <send id="createdMedicationRequest" desc="Create MedicationRequest in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$medicationRequestToCreate{convertedBody}</input>
        </send>

        <log>'Created MedicationRequest Data'</log>
        <log>$createdMedicationRequest</log>

        <!--
            verify data
        -->
        <verify id="verifycreateMedicationRequest" handler="StringValidator" desc="Check that medicationRequest got created successfully or not with correct data.">
            <input name="actualstring">$createdMedicationRequest{response}{body}{subject}{reference}</input>
            <input name="expectedstring">$medicationRequestToCreate{convertedBody}{subject}{reference}</input>
        </verify>

        <!-- Search Medication Request -->

        <send id="searchedMedicationRequest" desc="search same medicationRequest from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'MedicationRequest'</input>
            <input name="parameters">"_id=" || $createdMedicationRequest{response}{body}{id}</input>
        </send>
     
        <log>'Searched MedicationRequest Data'</log>
        <log>$searchedMedicationRequest</log>

        <!-- Verify Searched Medication Request -->

        <verify id="verifySearchMedicationRequest" handler="StringValidator" desc="Verify data of medicationRequest">
            <input name="actualstring">$searchedMedicationRequest{response}{body}{entry}{0}{resource}{subject}{reference}</input>
            <input name="expectedstring">$createdMedicationRequest{response}{body}{subject}{reference}</input>
        </verify>







        <!-- Convert Procedure -->

        <send id="procedureToCreate" desc="Convert procedureToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$procedureToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <assign to="procedureToCreate{convertedBody}{subject}{reference}">'Patient/'||$createdPatient{response}{body}{id}</assign>

        <!--
            Add log
        -->
        <log>'Converted Procedure Data'</log>
        <log>$procedureToCreate</log>

        <!-- Create Procedure -->

        <send id="createdProcedure" desc="Create Procedure in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$procedureToCreate{convertedBody}</input>
        </send>

        <log>'Created Procedure Data'</log>
        <log>$createdProcedure</log>

        <!--
            verify data
        -->
        <verify id="verifyCreateProcedure" handler="StringValidator" desc="Check that procedure got created successfully or not with correct data.">
            <input name="actualstring">$createdProcedure{response}{body}{code}{coding}{0}{code}</input>
            <input name="expectedstring">$procedureToCreate{convertedBody}{code}{coding}{0}{code}</input>
        </verify>

        <!-- Search Procedure -->

        <send id="searchedProcedure" desc="search same procedure from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'Procedure'</input>
            <input name="parameters">"_id=" || $createdProcedure{response}{body}{id}</input>
        </send>
     
        <log>'Searched Procedure Data'</log>
        <log>$searchedProcedure</log>

        <!-- Verify Searched Procedure -->

        <verify id="verifySearchProcedure" handler="StringValidator" desc="Verify data of procedure">
            <input name="actualstring">$searchedProcedure{response}{body}{entry}{0}{resource}{code}{coding}{0}{code}</input>
            <input name="expectedstring">$createdProcedure{response}{body}{code}{coding}{0}{code}</input>
        </verify>



        <!-- Convert Observation -->

        <send id="observationToCreate" desc="Convert observationToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$observationToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <assign to="observationToCreate{convertedBody}{subject}{reference}">'Patient/'||$createdPatient{response}{body}{id}</assign>

        <!--
            Add log
        -->
        <log>'Converted Observation Data'</log>
        <log>$observationToCreate</log>

        <!-- Create Observation -->

        <send id="createdObservation" desc="Create Observation in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$observationToCreate{convertedBody}</input>
        </send>

        <log>'Created Observation Data'</log>
        <log>$createdObservation</log>

        <!--
            verify data
        -->
        <verify id="verifyCreateObservation" handler="StringValidator" desc="Check that observation got created successfully or not with correct data.">
            <input name="actualstring">$createdObservation{response}{body}{code}{coding}{0}{code}</input>
            <input name="expectedstring">$observationToCreate{convertedBody}{code}{coding}{0}{code}</input>
        </verify>

        <!-- Search Observation -->

        <send id="searchedObservation" desc="search same observation from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'Observation'</input>
            <input name="parameters">"_id=" || $createdObservation{response}{body}{id}</input>
        </send>
     
        <log>'Searched Observation Data'</log>
        <log>$searchedObservation</log>

        <!-- Verify Searched Observation -->

        <verify id="verifySearchObservation" handler="StringValidator" desc="Verify data of observation">
            <input name="actualstring">$searchedObservation{response}{body}{entry}{0}{resource}{code}{coding}{0}{code}</input>
            <input name="expectedstring">$createdObservation{response}{body}{code}{coding}{0}{code}</input>
        </verify>



        <!-- Convert Allergy Intolerance -->

        <send id="allergyIntoleranceToCreate" desc="Convert allergyIntoleranceToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$allergyIntoleranceToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <assign to="allergyIntoleranceToCreate{convertedBody}{patient}{reference}">'Patient/'||$createdPatient{response}{body}{id}</assign>

        <!--
            Add log
        -->
        <log>'Converted AllergyIntolerance Data'</log>
        <log>$allergyIntoleranceToCreate</log>

        <!-- Create Allergy Intolerance -->

        <send id="createdAllergyIntolerance" desc="Create Allergy Intolerance in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$allergyIntoleranceToCreate{convertedBody}</input>
        </send>

        <log>'Created AllergyIntolerance Data'</log>
        <log>$createdAllergyIntolerance</log>

        <!--
            verify data
        -->
        <verify id="verifyCreateAllergyIntolerance" handler="StringValidator" desc="Check that allergyIntolerance got created successfully or not with correct data.">
            <input name="actualstring">$createdAllergyIntolerance{response}{body}{reaction}{0}{substance}{coding}{0}{code}</input>
            <input name="expectedstring">$allergyIntoleranceToCreate{convertedBody}{reaction}{0}{substance}{coding}{0}{code}</input>
        </verify>

        <!-- Search Allergy Intolerance -->

        <send id="searchedAllergyIntolerance" desc="search same allergyIntolerance from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'AllergyIntolerance'</input>
            <input name="parameters">"_id=" || $createdAllergyIntolerance{response}{body}{id}</input>
        </send>
     
        <log>'Searched Allergy Intolerance Data'</log>
        <log>$searchedAllergyIntolerance</log>

        <!-- Verify Searched Allergy Intolerance -->

        <verify id="verifySearchAllergyIntolerance" handler="StringValidator" desc="Verify data of allergyIntolerance">
            <input name="actualstring">$searchedAllergyIntolerance{response}{body}{entry}{0}{resource}{reaction}{0}{substance}{coding}{0}{code}</input>
            <input name="expectedstring">$createdAllergyIntolerance{response}{body}{reaction}{0}{substance}{coding}{0}{code}</input>
        </verify>



        <!-- Convert Immunization -->

        <send id="immunizationToCreate" desc="Convert allergyIntoleranceToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$immunizationToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <assign to="immunizationToCreate{convertedBody}{patient}{reference}">'Patient/'||$createdPatient{response}{body}{id}</assign>

        <!--
            Add log
        -->
        <log>'Converted Immunization Data'</log>
        <log>$immunizationToCreate</log>

        <!-- Create Immunization -->

        <send id="createdImmunization" desc="Create Immunization in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$immunizationToCreate{convertedBody}</input>
        </send>

        <log>'Created Immunization Data'</log>
        <log>$createdImmunization</log>

        <!--
            verify data
        -->
        <verify id="verifyCreateImmunization" handler="StringValidator" desc="Check that Immunization got created successfully or not with correct data.">
            <input name="actualstring">$createdImmunization{response}{body}{reaction}{0}{date}</input>
            <input name="expectedstring">$immunizationToCreate{convertedBody}{reaction}{0}{date}</input>
        </verify>

        <!-- Search Immunization -->

        <send id="searchedImmunization" desc="search same Immunization from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'Immunization'</input>
            <input name="parameters">"_id=" || $createdImmunization{response}{body}{id}</input>
        </send>
     
        <log>'Searched Immunization Data'</log>
        <log>$searchedImmunization</log>

        <!-- Verify Searched Immunization -->

        <verify id="verifySearchImmunization" handler="StringValidator" desc="Verify data of immunization">
            <input name="actualstring">$searchedImmunization{response}{body}{entry}{0}{resource}{reaction}{0}{date}</input>
            <input name="expectedstring">$createdImmunization{response}{body}{reaction}{0}{date}</input>
        </verify>



        <!-- Convert Diagnostic Report -->

        <send id="diagnosticReportToCreate" desc="Convert allergyIntoleranceToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$diagnosticReportToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <assign to="diagnosticReportToCreate{convertedBody}{subject}{reference}">'Patient/'||$createdPatient{response}{body}{id}</assign>

        <!--
            Add log
        -->
        <log>'Converted Diagnostic Report Data'</log>
        <log>$diagnosticReportToCreate</log>

        <!-- Create Diagnostic Report -->

        <send id="createdDiagnosticReport" desc="Create Observation in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$diagnosticReportToCreate{convertedBody}</input>
        </send>

        <log>'Created Diagnostic Report Data'</log>
        <log>$createdDiagnosticReport</log>

        <!--
            verify data
        -->
        <verify id="verifyCreateDiagnosticReport" handler="StringValidator" desc="Check that Diagnostic Report got created successfully or not with correct data.">
            <input name="actualstring">$createdDiagnosticReport{response}{body}{code}{coding}{0}{code}</input>
            <input name="expectedstring">$diagnosticReportToCreate{convertedBody}{code}{coding}{0}{code}</input>
        </verify>

        <!-- Search Diagnostic Report -->

        <send id="searchedDiagnosticReport" desc="search same Immunization from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'DiagnosticReport'</input>
            <input name="parameters">"_id=" || $createdDiagnosticReport{response}{body}{id}</input>
        </send>
     
        <log>'Searched DiagnosticReport Data'</log>
        <log>$searchedDiagnosticReport</log>

        <!-- Verify Searched Diagnostic Report -->

        <verify id="verifySearchDiagnosticReport" handler="StringValidator" desc="Verify data of diagnosticReport">
            <input name="actualstring">$searchedDiagnosticReport{response}{body}{entry}{0}{resource}{code}{coding}{0}{code}</input>
            <input name="expectedstring">$createdDiagnosticReport{response}{body}{code}{coding}{0}{code}</input>
        </verify>



        <!-- Convert Medication Administration -->

        <send id="medicationAdministrationToCreate" desc="Convert medicationAdministrationToCreate jsonString => anyContent" from="ITB" to="FhirHandler"
                handler="$DOMAIN{jsonStringConverterServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$medicationAdministrationToCreateInJsonString</input>
            <input name="bodyType">"jsonString"</input>
        </send>

        <assign to="medicationAdministrationToCreate{convertedBody}{medicationReference}{id}">'Medication/'||$createdMedication{response}{body}{id}</assign>
        <assign to="medicationAdministrationToCreate{convertedBody}{subject}{reference}">'Patient/'||$createdPatient{response}{body}{id}</assign>
        <assign to="medicationAdministrationToCreate{convertedBody}{context}{reference}">'Encounter/'||$createdEncounter{response}{body}{id}</assign>
        <assign to="medicationAdministrationToCreate{convertedBody}{performer}{0}{actor}{reference}">'Practitioner/'||$createdPractitioner{response}{body}{id}</assign>

        <!--
            Add log
        -->
        <log>'Converted Medication Administration Data'</log>
        <log>$medicationAdministrationToCreate</log>

        <!-- Create Medication Administration -->

        <send id="createdMedicationAdministration" desc="Create MedicalAdministration in FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"create"</input>
            <input name="body">$medicationAdministrationToCreate{convertedBody}</input>
        </send>

        <log>'Created Medication Administration Data'</log>
        <log>$createdMedicationAdministration</log>

        <!--
            verify data
        -->
        <verify id="verifyCreateMedicationAdministration" handler="StringValidator" desc="Check that Medication Administration got created successfully or not with correct data.">
            <input name="actualstring">$createdMedicationAdministration{response}{body}{subject}{reference}</input>
            <input name="expectedstring">$medicationAdministrationToCreate{convertedBody}{subject}{reference}</input>
        </verify>

        <!-- Search Medication Administration -->

        <send id="searchedMedicationAdministration" desc="search same Medical Administration from the FHIR server" from="ITB" to="FhirHandler"
                handler="$DOMAIN{fhirContextServiceAddress}">
            <input name="fhirServerBaseUrl">$componentURI</input>
            <input name="username">$username</input>
            <input name="password">$password</input>
            <input name="loginUrl">$loginUrl</input>
            <input name="loginType">$loginType</input>
            <input name="clientSecret">$clientSecret</input>
            <input name="clientId">$clientId</input>
            <input name="headerParamName">$headerParamName</input>
            <input name="headerParamValue">$headerParamValue</input>
            <input name="operationType">"search"</input>
            <input name="fhirResourceType">'MedicationAdministration'</input>
            <input name="parameters">"_id=" || $createdMedicationAdministration{response}{body}{id}</input>
        </send>
     
        <log>'Searched Medication Administration Data'</log>
        <log>$searchedMedicationAdministration</log>

        <!-- Verify Searched Medication Administration -->

        <verify id="verifySearchMedicationAdministration" handler="StringValidator" desc="Verify data of medicationAdministration">
            <input name="actualstring">$searchedMedicationAdministration{response}{body}{entry}{0}{resource}{subject}{reference}</input>
            <input name="expectedstring">$createdMedicationAdministration{response}{body}{subject}{reference}</input>
        </verify>


    </steps>

    <output>
        <success>
            <default>"Test case completed successfully."</default>
        </success>
        <failure>
            <case>
                <cond>$STEP_STATUS{verifyCreatePatient} = 'ERROR'</cond>
                <message>"Patient Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchPatient} = 'ERROR'</cond>
                <message>"Patient Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreatePractitioner} = 'ERROR'</cond>
                <message>"Practitioner Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchPractitioner} = 'ERROR'</cond>
                <message>"Practitioner Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreateOrganization} = 'ERROR'</cond>
                <message>"Organization Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchOrganization} = 'ERROR'</cond>
                <message>"Organization Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreatePractitionerRole} = 'ERROR'</cond>
                <message>"Practitioner Role Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchPractitionerRole} = 'ERROR'</cond>
                <message>"Practitioner Role Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreatePatient} = 'ERROR'</cond>
                <message>"Patient Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchPatient} = 'ERROR'</cond>
                <message>"Patient Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreateEncounter} = 'ERROR'</cond>
                <message>"Encounter Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchEncounter} = 'ERROR'</cond>
                <message>"Encounter Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreateCondition} = 'ERROR'</cond>
                <message>"Condition Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchCondition} = 'ERROR'</cond>
                <message>"Condition Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreateMedication} = 'ERROR'</cond>
                <message>"Medication Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchMedication} = 'ERROR'</cond>
                <message>"Medication Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifycreateMedicationRequest} = 'ERROR'</cond>
                <message>"Medication Request Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchMedicationRequest} = 'ERROR'</cond>
                <message>"Medication Request Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreateImmunization} = 'ERROR'</cond>
                <message>"Immunization Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchImmunization} = 'ERROR'</cond>
                <message>"Immunization Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreateDiagnosticReport} = 'ERROR'</cond>
                <message>"Diagnostic Report Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchDiagnosticReport} = 'ERROR'</cond>
                <message>"Diagnostic Report Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreateMedicationAdministration} = 'ERROR'</cond>
                <message>"Medication Administration Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchMedicationAdministration} = 'ERROR'</cond>
                <message>"Medication Administration Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreateAllergyIntolerance} = 'ERROR'</cond>
                <message>"Allergy Intolerance Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchAllergyIntolerance} = 'ERROR'</cond>
                <message>"Allergy Intolerance Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreateProcedure} = 'ERROR'</cond>
                <message>"Procedure Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchProcedure} = 'ERROR'</cond>
                <message>"Procedure Search Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifyCreateObservation} = 'ERROR'</cond>
                <message>"Observation Creation Failed"</message>
            </case>
            <case>
                <cond>$STEP_STATUS{verifySearchObservation} = 'ERROR'</cond>
                <message>"Observation Search Failed"</message>
            </case>
            <default>"Test case failed."</default>
        </failure>
    </output>  
</testcase>
