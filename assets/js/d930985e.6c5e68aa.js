"use strict";(self.webpackChunktht_doc=self.webpackChunktht_doc||[]).push([[358],{9624:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var t=i(4848),o=i(8453);const s={id:"installation",title:"Installation And Production Deployment"},r="Installation",l={id:"Getting-Started/installation",title:"Installation And Production Deployment",description:"Testing harness tool is a complete test framework that will facilitate testing how well technologies align to the OpenHIE Architecture specification and health and data content, as specified by WHO SMART Guidelines.",source:"@site/docs/Getting-Started/installation.mdx",sourceDirName:"Getting-Started",slug:"/Getting-Started/installation",permalink:"/ohie-test-harness/docs/Getting-Started/installation",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"installation",title:"Installation And Production Deployment"},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/ohie-test-harness/docs/Introduction"},next:{title:"Testing Harness Tool",permalink:"/ohie-test-harness/docs/User-Guide/introduction"}},d={},c=[{value:"Setting Up File System",id:"setting-up-file-system",level:2},{value:"Step 1: Create Directories",id:"step-1-create-directories",level:3},{value:"Step 2: Set Permissions",id:"step-2-set-permissions",level:3},{value:"Docker Configuration",id:"docker-configuration",level:2},{value:"Docker Installation",id:"docker-installation",level:3},{value:"Linux(Ubuntu)",id:"linuxubuntu",level:4},{value:"Docker Setup",id:"docker-setup",level:3},{value:"Step 1: Directory Modifications and Initial Zip File Movement",id:"step-1-directory-modifications-and-initial-zip-file-movement",level:4},{value:"Step 2: Launch Docker-Compose",id:"step-2-launch-docker-compose",level:4},{value:"Docker Guide",id:"docker-guide",level:3},{value:"1: Docker Commands For Initial Setup",id:"1-docker-commands-for-initial-setup",level:4},{value:"2: Docker Rerun Commands",id:"2-docker-rerun-commands",level:4},{value:"3: Schedule Database Backup",id:"3-schedule-database-backup",level:4},{value:"4: Restore Database Backup",id:"4-restore-database-backup",level:4}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.p,{children:"Testing harness tool is a complete test framework that will facilitate testing how well technologies align to the OpenHIE Architecture specification and health and data content, as specified by WHO SMART Guidelines."}),"\n",(0,t.jsx)(n.h2,{id:"setting-up-file-system",children:"Setting Up File System"}),"\n",(0,t.jsx)(n.h3,{id:"step-1-create-directories",children:"Step 1: Create Directories"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Open a terminal window."}),"\n",(0,t.jsxs)(n.li,{children:["Navigate to the ",(0,t.jsx)(n.code,{children:"/srv"})," directory:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cd /srv\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Create a directory named tht:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mkdir tht\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Inside the tht directory, create three more directories:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["error-logs to store error logs based on dates.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mkdir tht/error-logs\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["files where DocumentService related files will be stored.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mkdir tht/files\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["files where database backup related files will be stored.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mkdir tht/backup\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"step-2-set-permissions",children:"Step 2: Set Permissions"}),"\n",(0,t.jsx)(n.p,{children:"Run this command for permission update:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sudo chmod -R a+rwx /srv/tht\n"})}),"\n",(0,t.jsx)(n.h2,{id:"docker-configuration",children:"Docker Configuration"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#docker-installation",children:"Docker Installed"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#docker-setup",children:"Docker Setup"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#docker-guide",children:"Docker Guide"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"docker-installation",children:"Docker Installation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["One can refer the official Docker website at ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/engine/install/ubuntu/",children:"https://docs.docker.com/engine/install/ubuntu/"})," or visit DigitalOcean's documentation for instructions on installing Docker on Ubuntu 20.04. The steps outlined are sourced from DigitalOcean's guide available at ",(0,t.jsx)(n.a,{href:"https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04",children:"https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"linuxubuntu",children:"Linux(Ubuntu)"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Update existing list of packages:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sudo apt update\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Install a few prerequisite packages:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sudo apt install apt-transport-https ca-certificates curl software-properties-common\n"})}),"\n","These let apt use packages over HTTPS."]}),"\n",(0,t.jsxs)(n.li,{children:["Install curl:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sudo apt update\n"})}),"\n","This command updated existing list of packages.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sudo apt install curl\n"})}),"\n","This command will install the curl package.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"curl --version\n"})}),"\n","This command will give the version of curl that has been installed. You can use this to check curl installation result.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"curl http://www.example.com/\n"})}),"\n","This command fetches the contents of the given webpage. It is used to check of curl is working properly."]}),"\n",(0,t.jsxs)(n.li,{children:["Add GPG key:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n"})}),"\n","This adds the GPG key of official docker repository in your system."]}),"\n",(0,t.jsxs)(n.li,{children:["Add Docker repository to APT sources:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable"\n'})}),"\n","This will also update our package database with the Docker packages from the newly added repo."]}),"\n",(0,t.jsxs)(n.li,{children:["Run this command in the terminal:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"apt-cache policy docker-ce\n"})}),"\n","This command makes sure you are about to install from the Docker repo instead of the default Ubuntu repo\nYou\u2019ll see output like this, although the version number for Docker may be different:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"docker-ce:\n    Installed: (none)\n    Candidate: 5:19.03.9~3-0~ubuntu-focal\n    Version table:\n        5:19.03.9~3-0~ubuntu-focal 500\n            500 https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\n"})}),"\n","Notice that docker-ce is not installed, but the candidate for installation is from the Docker repository for Ubuntu 20.04 (focal)."]}),"\n",(0,t.jsxs)(n.li,{children:["Install Docker","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sudo apt install docker-ce\n"})}),"\n","Docker should now be installed, the daemon started, and the process enabled to start on boot."]}),"\n",(0,t.jsxs)(n.li,{children:["Check if it is running:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sudo systemctl status docker\n"})}),"\n","The output should be similar to the following, showing that the service is active and running:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u25cf docker.service - Docker Application Container Engine\n    Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)\n    Active: active (running) since Tue 2020-05-19 17:00:41 UTC; 17s ago\nTriggeredBy: \u25cf docker.socket\n    Docs: https://docs.docker.com\nMain PID: 24321 (dockerd)\n    Tasks: 8\n    Memory: 46.4M\n    CGroup: /system.slice/docker.service\n            \u2514\u250024321 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"docker-setup",children:"Docker Setup"}),"\n",(0,t.jsx)(n.h4,{id:"step-1-directory-modifications-and-initial-zip-file-movement",children:"Step 1: Directory Modifications and Initial Zip File Movement"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Go to the project directory.(The extracted folder of the GitHub zip file)"}),"\n",(0,t.jsxs)(n.li,{children:["Execute the following command:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sudo bash ./copy_zips.sh files\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["The terminal will display the list of files copied to the directory ",(0,t.jsx)(n.code,{children:"/srv/tht/files"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Grant permissions to that folder using the following command:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sudo chmod -R 777 /srv/tht\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"step-2-launch-docker-compose",children:"Step 2: Launch Docker-Compose"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Navigate to the project directory.(The extracted folder of the GitHub zip file)"}),"\n",(0,t.jsxs)(n.li,{children:["Run the following command:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" sudo docker compose up\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"tht.env"})," file is available to configure ports and other settings. If needed, make changes there."]}),"\n",(0,t.jsxs)(n.li,{children:["Attempt to access ",(0,t.jsx)(n.code,{children:"http://localhost:3000/"})," to reach the testing-harness-tool's login page."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"docker-guide",children:"Docker Guide"}),"\n",(0,t.jsx)(n.h4,{id:"1-docker-commands-for-initial-setup",children:"1: Docker Commands For Initial Setup"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Navigate to the project directory.(The extracted folder of the GitHub zip file)"}),"\n",(0,t.jsxs)(n.li,{children:["Run the following command to build the docker:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" sudo docker-compose --env-file tht-prod.env build\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Run the following command to run docker:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" sudo docker-compose --env-file tht-prod.env up\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," Replace docker-compose with docker compose if the Ubuntu version is newer then 20.04.2 LTS"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"2-docker-rerun-commands",children:"2: Docker Rerun Commands"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Navigate to the project directory.(The extracted folder of the GitHub zip file)"}),"\n",(0,t.jsxs)(n.li,{children:["Run the following command docker down","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" sudo docker-compose down\n"})}),"\n","OR\nRun the following command docker down Along with database refresh","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" sudo docker-compose down -v\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Run the following command to fetch the new code:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" git pull\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Run the following command to build the docker:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" sudo docker-compose --env-file tht-prod.env build\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Run the following command to run docker:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" sudo docker-compose --env-file tht-prod.env up\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," Replace docker-compose with docker compose if the Ubuntu version is newer then 20.04.2 LTS"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"3-schedule-database-backup",children:"3: Schedule Database Backup"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Navigate to the project directory.(The extracted folder of the GitHub zip file)"}),"\n",(0,t.jsxs)(n.li,{children:["Run the following command:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" crontab -e\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Write following line and replace ProjectDirectoryPath while writing and save it.","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" * 2 * * * {ProjectDirectoryPath}/backup.sh\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Now everyday at 2:00 a.m. database backup will get stored in ",(0,t.jsx)(n.code,{children:"/srv/tht/backup"})," directory and latest 2 copy will be available."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"4-restore-database-backup",children:"4: Restore Database Backup"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Navigate to the project directory.(The extracted folder of the GitHub zip file)"}),"\n",(0,t.jsxs)(n.li,{children:["Using following command to stop docker:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" sudo docker-compose down\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Now run following command to restore database:\nTo restore latest backup","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" sudo sh restoreLatest.sh\n"})}),"\n","To restore second latest backup","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" sudo sh restoreSecondLatest.sh\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Using following command to up docker:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" sudo docker-compose up\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"NOTE:"})," Replace docker-compose with docker compose if the Ubuntu version is newer then 20.04.2 LTS"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);